# アプリケーションからのロード、セーブをSD対応とさせるパッチあてWindows用ツール「CMT2SD_CHECK」

　MZ-80K_SDアダプタを繋ぐだけでもBASIC SP-5030が約4秒で起動できるようになるなどアプリケーションランチャーとして便利に使えますが、今まではMONITOR SP-1002にパッチをあてることを前提としていたためMONITOR ROMを交換しないとBASIC SP-5030等アプリケーションの起動はSDからできてもアプリケーションからのロード、セーブはCMTからとなってしまいます。

　そこでROMはそのままにしてアプリケーション側にSD対応パッチを当てるツールを作ってみました。

## CMT2SD_CHECKの使い方

　デスクトップ等適当な場所に「CMT2SD_CHECK.EXE」をコピーしてダブルクリックで起動させてください。

　次にSD用パッチを当てたいMZTファイルをCMT2SD_CHECKにドラッグアンドドロップしてください。

　ドロップされたアプリケーションにMONITOR SP-1002のCMT関連ルーチンを呼び出していると思われるコードが発見された場合は、元のMZTファイルと同じフォルダに元のMZTファイルのファイルネームに「_SD」を付加したMZTファイルと変更箇所を保存したTXTファイルを作成します。

　ドロップされたアプリケーションにMONITOR SP-1002のCMT関連ルーチンを呼び出していると思われるコードが無い場合には、何も作成されません。

例)

　「BASIC SP-5030.mzt」をドラッグアンドドロップ

　　BASIC SP-5030_SD.mzt、BASIC SP-5030_SD.txtが作成される。

![BASIC SP-5030](https://github.com/yanataka60/MZ80K_SD/blob/main/JPEG/CMT2SD_CHECK_1.jpg)

## 注意点
　「CMT2SD_CHECK.EXE」はMONITOR SP-1002のCMT関連ルーチンを呼び出していると思われるコードと一致した場合にパッチを当てますが、アプリケーションの中では命令コードではなくデータとして扱っているバイナリがたまたま一致した場合にもパッチを当ててしまいます。

　動作がおかしい場合には、変更箇所テキストファイルを参照して元に戻してください。

　また、コール命令(CD)、ジャンプ命令(C3)を使わずにCMT関連ルーチンを呼び出しているアプリケーションは検出できません。

## 「CMT2SD_CHECK.EXE」ソースコードについて
　「CMT2SD_CHECK.EXE」はDelphi 10.4Community Editionを使って作成しました。

　Pascalにしては拙いコードだとは思いますが、ご容赦願います。

## 追記
2022.6.30

　Z80フォルダの「FD_rom.BIN」を今回の「FD_rom.BIN」へ置き換えました。

　「CMT2SD_CHECK」によりパッチを当てたアプリケーションを使うときには新しい「FD_rom.BIN」への交換が必要です。

　CHECKの仕方を修正。機能に変更なし。